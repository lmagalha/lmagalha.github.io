<html>
<head>

</head>

<body>
<script>

let xrRefSpace=null;
let gl=null;
let renderer=null;

function initAR()
{

        if (navigator.xr) {
          navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
            console.log("AR content is supported!");
			onRequestSession();
          })
		  .catch((reason) => { console.log("AR content is not supported: " + reason); });
        }
}

      function onRequestSession() {
        // Requests an 'immersive-ar' session, which ensures that the users
        // environment will be visible either via video passthrough or a
        // transparent display. This may be presented either in a headset or
        // fullscreen on a mobile device.
        navigator.xr.requestSession('immersive-ar')
            .then((session) => {
              session.isImmersive = true;
			  console.log("Session requested!");
              onSessionStarted(session);
            });
      }
	  
      function initGL() {
        if (gl)
          return;

        gl = createWebGLContext({
          xrCompatible: true
        });
        document.body.appendChild(gl.canvas);

        function onResize() {
          gl.canvas.width = gl.canvas.clientWidth * window.devicePixelRatio;
          gl.canvas.height = gl.canvas.clientHeight * window.devicePixelRatio;
        }
        window.addEventListener('resize', onResize);
        onResize();

        renderer = new Renderer(gl);

      }	  

function onSessionStarted(xrSession) {

initGL();

  xrSession.requestReferenceSpace('local')
  .then((refSpace) => {
    xrRefSpace = refSpace;
    xrSession.requestAnimationFrame(onXRFrame);
  });
}

      function onXRFrame(t, frame) {
        let session = frame.session;

        let pose = frame.getViewerPose(xrRefSpace);

        session.requestAnimationFrame(onXRFrame);
		
		// draw scene

      }  

initAR();
</script>
</body>

</html>
